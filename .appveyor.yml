environment:
  VUE_TEMPLATES: "minimal full full-airbnb"

cache:
  - node_modules
  - examples\full\node_modules
  - examples\full-airbnb\node_modules
  - examples\minimal\node_modules
  - '%APPDATA%\npm-cache'
  - '%USERPROFILE%\.npm'
  - '%USERPROFILE%\.cache'

install:
  - ps: Install-Product node 8
  - ps: Install-Module -Name PSWriteColor
  - npm install -g yarn vue-cli
  - yarn install --frozen-lockfile

test_script:
  - ps: >-
      function Test-Extension() {
        Write-Color "Working inside ", (Get-Location).path, " folder..." -Color White, Yellow, White

        Write-Color "[$($env:VUE_TEMPLATE)]", " Installing extension dependencies..." -Color Yellow, White
        yarn install --frozen-lockfile

        Write-Color "[$($env:VUE_TEMPLATE)]", " Building extension..." -Color Yellow, White
        yarn build
      }

      function Create-Extension() {
        Param($Template)
        $env:VUE_TEMPLATE = $Template

        cd "$($env:APPVEYOR_BUILD_FOLDER)/tests"
        Write-Color "[$($env:VUE_TEMPLATE)]", "Creating extension following ", $Template, " scenario..." -Color Yellow, White, Yellow, White
        vue init .. "extension-$($Template)"

        cd "extension-$($Template)"
        Test-Extension
      }

      foreach($VUE_TEMPLATE in $env:VUE_TEMPLATES.split(" ")) {
        Create-Extension -Template $VUE_TEMPLATE
      }

      exit $?

build: off
